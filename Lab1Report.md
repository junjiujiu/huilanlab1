## 实验一实验报告

**名称**：EnglishPal的模块和类依赖关系

**作者**：李玉盈 201831990607，黄诗雅 201831990103，徐坚苗 201831990136

**日期**：2021.5.19

## 摘要

为了使我们的软件应用程序中避免“大泥浆球”反模式。需要找到软件项目之间的类和模块间的依赖关系，能够更好的分析项目的关系。

[Read the docs](https://huilanlab1.readthedocs.io/en/latest/Lab1Report.html)

## 方法和材料

我们使用`Snakefood`对`EnglishPal`进行模块依赖关系的分析，并使用`Graphviz Online`渲染出图像。由于未找到可用的对`python`代码进行类依赖关系分析的工具，我们选择人工分析`EnglishPal`并手写`mermaid`代码进行依赖图的绘制。

模块依赖图的生成：

```
git clone https://github.com/lanlab-org/EnglishPal
```

```
mkdir EnglishPalSourceCode
```

```
cp EnglishPal/app/*.py EnglishPalSourceCode
```

```
cd EnglishPalSourceCode/
```

```
sfood . | sfood-graph
```

## 结果

达成了目标的**百分之七十**（其它百分之三十由室友帮助下写出）

##### 1、模块依赖关系图

代码部分：

```python
# This file was generated by sfood-graph.

strict digraph "dependencies" {
    graph [
        rankdir = "LR",
        overlap = "scale",
        size = "8,10",
        ratio = "fill",
        fontsize = "16",
        fontname = "Helvetica",
        clusterrank = "local"
        ]

       node [
           fontsize=7
           shape=ellipse
//           style=filled
//           shape=box
       ];

//     node [
//         fontsize=7
//       style=ellipse
//     ];

"UseSqlite.py"  [style=filled];
"UseSqlite.py" -> "sqlite3";
"WordFreq.py"  [style=filled];
"WordFreq.py" -> "wordfreqCMD.py";
"WordFreq.py" -> "string.py";
"difficulty.py"  [style=filled];
"difficulty.py" -> "wordfreqCMD.py";
"difficulty.py" -> "math";
"difficulty.py" -> "pickle.py";
"main.py"  [style=filled];
"main.py" -> "UseSqlite.py";
"main.py" -> "WordFreq.py";
"main.py" -> "difficulty.py";
"main.py" -> "pickle_idea.py";
"main.py" -> "pickle_idea2.py";
"main.py" -> "wordfreqCMD.py";
"main.py" -> "datetime";
"main.py" -> "glob.py";
"main.py" -> "os.py";
"main.py" -> "random.py";
"pickle_idea.py"  [style=filled];
"pickle_idea.py" -> "pickle.py";
"pickle_idea2.py"  [style=filled];
"pickle_idea2.py" -> "datetime";
"pickle_idea2.py" -> "pickle.py";
"wordfreqCMD.py"  [style=filled];
"wordfreqCMD.py" -> "pickle_idea.py";
"wordfreqCMD.py" -> "collections.py";
"wordfreqCMD.py" -> "operator";
"wordfreqCMD.py" -> "os.py";
"wordfreqCMD.py" -> "string.py";
"wordfreqCMD.py" -> "sys";
}
```

模块间的依赖图显示![](https://ftp.bmp.ovh/imgs/2021/05/937bbc028ea3ba69.png)

##### 2、类间的依赖关系图

①首先因为`X-Ray`只能够对java进行生成，在网上查询到有一个VS的插件可以生成可视化的关系依赖图
链接如下：
https://jingyan.baidu.com/article/7c6fb4282a436280642c9025.html

②由此我们去下载并安装激活了`Resharper 2017.2`，下载安装链接以及步骤：http://www.xue51.com/soft/4787.html
链接中的激活码并不能用，所以找到了另一个激活码`http://idea.iteblog.com/key.php`
花费三小时解决了安装问题，安装并激活了后的截图![](https://ftp.bmp.ovh/imgs/2021/05/1a709e237cfcc12f.png)

③根据步骤生成查看依赖图之后，
![查看关系依赖图失败](https://ftp.bmp.ovh/imgs/2021/05/c93bd5ec7ab4e0f4.png)

发现并不能显示`python`的关系依赖图，上网再次查询后发现它也只是能够生成`java`的类的关系依赖图，沮丧的还是没有找到比较适合的解决方法

④于是最后还是选择了手绘，鉴于手绘自己并不能很快的画出来，于是请教了软英班的室友，在室友的帮助下磕磕绊绊总算写出来了，不完全算是自己写出来的

代码展示：

```
graph LR
WordFreq --> wordfreqCMD.remove_punctuation
WordFreq --> wordfreqCMD.freq
WordFreq.get_freq --> wordfreqCMD.sort_in_descending_order
main.load_freq_history --> pickle_idea.load_record
main.verify_user --> RecordQuery
main.verify_user --> RecordQuery.instructions
main.verify_user --> RecordQuery.get_results
main.add_user --> InsertQuery
main.add_user --> InsertQuery.instructions
main.add_user --> InsertQuery.do
main.check_username_availability --> RecordQuery.__init__
main.check_username_availability --> RecordQuery.instructions
main.check_username_availability --> RecordQuery.do
main.check_username_availability --> RecordQuery.get_results
main.get_expiry_date --> RecordQuery
main.get_expiry_date --> RecordQuery.instructions
main.get_expiry_date --> RecordQuery.do
main.get_expiry_date --> RecordQuery.get_results
main.get_today_article --> RecordQuery
main.get_today_article --> RecordQuery.instructions
main.get_today_article --> RecordQuery.do
main.get_today_article --> RecordQuery.get_results
main.get_today_article --> main.load_freq_history
main.get_today_article --> difficulty.get_difficulty_level
main.get_today_article --> difficulty.text_difficulty_level
main.mark_word --> main.load_freq_history
main.mark_word --> pickle_idea.dict2lst
main.mark_word --> pickle_idea.merge_frequency
main.mark_word --> pickle_idea.save_frequency_to_pickle
main.mainpage --> WordFreq
main.mainpage --> WordFreq.get_freq
main.mainpage --> main.load_freq_history
main.mainpage --> pickle_idea.dict2lst
main.mainpage --> pickle_idea.merge_frequency
main.mainpage --> pickle_idea.save_frequency_to_pickle
main.mainpage --> wordfreqCMD.sort_in_descending_order
main.mainpage --> wordfreqCMD.youdao_link
main.user_mark_word --> main.load_freq_history
main.user_mark_word --> pickle_idea2.dict2lst
main.user_mark_word --> pickle_idea2.merge_frequency
main.user_mark_word --> pickle_idea2.save_frequency_to_pickle
main.userpage --> WordFreq
main.userpage --> WordFreq.get_freq
main.userpage --> pickle_idea.load_record
main.userpage --> main.get_today_article
main.userpage --> main.load_freq_history
main.userpage --> pickle_idea2.dict2lst
main.userpage --> wordfreqCMD.youdao_link
main.signup --> main.add_user
difficulty.load_record --> pickle.load
difficulty.get_difficulty_level --> difficulty.difficulty_level_from_frequency
difficulty.user_difficulty_level --> difficulty.revert_dict
difficulty.user_difficulty_level --> wordfreqCMD.sort_in_ascending_order
difficulty.text_difficulty_level --> wordfreqCMD.remove_punctuation
difficulty.text_difficulty_level --> wordfreqCMD.freq
difficulty.text_difficulty_level --> wordfreqCMD.sort_in_descending_order
main.signup --> main.verify_user
main.signup --> main.check_username_availability
main.login --> main.verify_user
main.login --> main.get_expiry_date
```

图片展示（太长了有点糊）：

![](https://ftp.bmp.ovh/imgs/2021/05/0b569f175c8e5a01.png)

## 优缺点

优点：项目比较简洁，简单，大部分人上手研究就大概能懂，所以代码的维护会比较简单，修改小bug的时候也比较容易找到并修改

缺点：需要去大幅度更改项目的时候，比如创新一些东西的时候不太能够大幅度改进，阻碍了以后的发展，感觉并不能够走得太远

## 讨论

在使用`snakefood`进行模块的依赖关系分析时，由于电脑无法成功下载`snakefood`，于是使用老师所部属的服务器进行操作。我们使用`putty`进行`ssh`连接，但是不知为何第一天登录服务器的时候无法成功，所幸第二天成功了。之后便顺利的按照老师上课的演示完成模块间依赖关系的分析。

## 参考

[编写计算机实验报告](https://thehackpost.com/a-brief-guide-how-to-write-a-computer-science-lab-report.html)

[关系依赖图参考](https://thedailywtf.com/images/201101/DependencyGraph.png)

[EnglishPal的GitHub链接](https://github.com/lanlab-org/EnglishPal)

[查询到的可以使用VS插件生成关系依赖图](https://jingyan.baidu.com/article/7c6fb4282a436280642c9025.html)

[snakefood的使用](http://furius.ca/snakefood/)

[snakefood的使用手册（模块间的依赖图生成参考）](http://furius.ca/snakefood/doc/snakefood-doc.html)